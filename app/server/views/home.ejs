<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Quizzet-Recommender</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="css/metisMenu.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/sb-admin-2.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="css/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <style>
        .radio-text {
            vertical-align: top;
            margin-right: 3%;
            font-size:14px;
        }
    </style>

    <script src="js/vendor/jquery.min.js"></script>

</head>

<body>

<script>
    var numAttempts = parseInt("<%= questionInfo.num_choices / 2 %>");

    var maxPoints = 0;
    var penalty = 0;
    var score = 0;
    var weight = 0;
    var weightUpdate = 0;
    var level = "<%= questionInfo.level %>";
    if (level === "Easy") {
        maxPoints = 10;
        penalty = -15;
        weight = 50;
    } else if (level === "Moderate") {
        maxPoints = 20;
        penalty = -10;
        weight = 40;
    } else if (level === "Difficult") {
        maxPoints = 30;
        penalty = -5;
        weight = 30;
    }

    var question = "<%= question %>";
    var questionId = parseInt("<%= questionInfo.question_id %>");
    var answer = "<%= questionInfo.answer %>";
    var topic = "<%= questionInfo.course_topic %>";
    var result = false;
    var attemptsLeft = numAttempts;

    function checkAnswer() {
        var choice = $('input[type=radio]:checked', '#myForm').val();
        var answerId = answer.substring(6,7).charCodeAt(0)-64;

        var submitElement = document.getElementById("submit_button");
        var alertElement = document.getElementById("alert_text");
        var nextQuestion = document.getElementById("nextQuestion");
        var resultElement = document.getElementById("result");
        resultElement.removeAttribute("hidden");

        if (parseInt(choice) === answerId){
            alertElement.innerText = "Right answer!!! Please proceed to the next question.";
            resultElement.classList.remove("alert-danger");
            resultElement.classList.add("alert-success");
            submitElement.setAttribute("disabled", true);
            nextQuestion.removeAttribute("disabled");
            result = true;
            score = maxPoints;
            weightUpdate = weight / (numAttempts - attemptsLeft);

            var http = new XMLHttpRequest();
            var url = "/updateWeight";
            var data = JSON.stringify({questionId: questionId, weight: weightUpdate});
            http.open("POST", url);
            http.setRequestHeader("Content-Type", "application/json");
            http.send(data);
        } else {
            attemptsLeft -= 1;
            score = penalty;
            if (!attemptsLeft) {
                alertElement.innerText = "You've run out of attempts for this question! Please proceed to the next question.";
                resultElement.classList.remove("alert-success");
                resultElement.classList.add("alert-danger");
                submitElement.setAttribute("disabled", true);
                nextQuestion.removeAttribute("disabled");
            } else {
                alertElement.innerText = "Wrong answer! Please try again.";
                resultElement.classList.remove("alert-success")
                resultElement.classList.add("alert-danger");
            }
        }

        var http = new XMLHttpRequest();
        var url = "/logActivity";
        var data = JSON.stringify({question: question, topic: topic, result: result, score: score});
        http.open("POST", url);
        http.setRequestHeader("Content-Type", "application/json");
        http.send(data);
    }

    $(document).ready(function () {
        $(".radio").on("click", function (event) {
            var elementId = event.target.id;
            var radioId = "#optionsRadios" + elementId[elementId.length - 1];
            $(radioId).prop("checked", true);
        });
    });
</script>

<div id="wrapper">
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Advanced Quizzet <sub>Human Intelligence Interpreted</sub></a>
        </div>

        <ul class="nav navbar-top-links navbar-right">
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-tasks">
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Score : <%= score%> </strong>
                                </p>
                                <i class="fa fa-star fa-5x" aria-hidden="true" style="color: gold; margin:auto;padding-left:35%;"></i>

                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 2</strong>
                                    <span class="pull-right text-muted">20% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                        <span class="sr-only">20% Complete</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 3</strong>
                                    <span class="pull-right text-muted">60% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                        <span class="sr-only">60% Complete (warning)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 4</strong>
                                    <span class="pull-right text-muted">80% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                        <span class="sr-only">80% Complete (danger)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a class="text-center" href="#">
                            <strong>See All Tasks</strong>
                            <i class="fa fa-angle-right"></i>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-alerts">
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-comment fa-fw"></i> New Comment
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                <span class="pull-right text-muted small">12 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-envelope fa-fw"></i> Message Sent
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-tasks fa-fw"></i> New Task
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a class="text-center" href="#">
                            <strong>See All Alerts</strong>
                            <i class="fa fa-angle-right"></i>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="userProfile"><i class="fa fa-user fa-fw"></i> User Profile</a>
                    </li>
                    <li><a href="/settings"><i class="fa fa-gear fa-fw"></i> Settings</a>
                    </li>
                    <li class="divider"></li>
                    <li><a href="/logout"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                    </li>
                </ul>
            </li>
        </ul>

        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li>
                        <div class="profile clearfix">
                            <div class="profile_pic">
                                <img src="images/male.png" alt="..." style="padding-left: 25px;" id ="avatar">
                            </div>
                            <div class="profile_info">
                                    <h3 id="fullname" style="padding-left: 5px; padding-right: 5px; text-align: center;"></h3>
                            </div>
                            <script>
                                var fullname = <%- JSON.stringify(fullname) %>;
                                var gender = <%- JSON.stringify(gender) %>;
                                if (gender == "Male") {
                                    document.getElementById("avatar").src = "images/male.png";
                                }
                                else {
                                    document.getElementById("avatar").src = "images/female.png";
                                }
                                document.getElementById("fullname").innerText = "Welcome, " + fullname;
                            </script>
                        </div>
                    </li>
                    <li>
                        <a href="/home"><i class="fa fa-edit fa-fw"></i> Home</a>
                    </li>
                    <li>
                        <a href="/history"><i class="fa fa-history" aria-hidden="true"></i> History</a>
                    </li>
                    <li>
                        <a href="/leaderboard"><i class="fa fa-users" aria-hidden="true"></i> Leaderboard</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="page-wrapper">
        <br/>
        <div class="card mb-3">
            <div class="card-header">
                <h4><i class="fa fa-bell-o"></i> Question :</h4>
            </div>
            <div class="list-group list-group-flush small">
                <a class="list-group-item list-group-item-action" href="#">
                    <div class="media">
                        <div class="media-body">
                            <h5><strong><code><%- question %></code></strong></h5>
                            <div class="text-muted smaller">
                                <h5>Choose your answer from the options below:</h5>
                            </div>
                        </div>
                    </div>
                </a>

                <br/>

                <form role="form" id ="myForm" action="/home" method="get">
                    <fieldset>
                        <% var i = 1;
                           while (i <= questionInfo.num_choices) { %>
                           <a class="list-group-item list-group-item-action">
                               <div class="media">
                                   <div class="media-body">
                                       <div class="radio" id=<%= "radioLinks" + i %> >
                                           <label for=<%= "optionsRadios" + i %>>
                                               <input type="radio" class="optionsRadios" id=<%= "optionsRadios" + i %> name="radAnswer" value=<%= i %> >
                                                    <span class="radio-text"><% if(i==1) {%> <%- questionInfo.choice_a %> <%}
                                                        else if(i==2) {%> <%- questionInfo.choice_b %> <%}
                                                        else if(i==3) {%> <%- questionInfo.choice_c %> <%}
                                                        else if(i==4) {%> <%- questionInfo.choice_d %> <%}
                                                        else if(i==5) {%> <%- questionInfo.choice_e %> <%}
                                                     %></span>
                                           </label>
                                       </div>
                                   </div>
                               </div>
                           </a>
                        <%i++;
                        }%>

                        <br/>
                        <div>
                            <div class="form-group" style="float:left; width:25%">
                                <button id="submit_button" type="button" class="btn btn-success" onclick="checkAnswer()">Submit <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                            </div>
                            <div class="form-group" style="float:right">
                                <button type="submit" class="btn btn-success" id="nextQuestion" disabled>Next Question <i class="fa fa-arrow-right" aria-hidden="true"></i></button>
                            </div>
                        </div>
                    </fieldset>
                </form>
                <div class="alert alert-danger text-center" role="alert" id="result" hidden>
                    <h5 id="alert_text"></h5>
                </div>
                <br/>
            </div>
        </div>
    </div>
</div>

<!-- jQuery -->

<!-- Bootstrap Core JavaScript -->
<script src="js/vendor/bootstrap.min.js"></script>

</body>

</html>
